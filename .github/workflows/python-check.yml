name: –ó–∞–ø—É—Å–∫ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–æ–∫ Python

on:
  push:
    branches: [proga]
  pull_request:
    branches: [proga]

jobs:
  run-python:
    runs-on: ubuntu-latest

    steps:
      - name: –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        uses: actions/checkout@v3

      - name: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.13"

      - name: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: –ó–∞–ø—É—Å–∫ .py —Ñ–∞–π–ª–æ–≤ –±–µ–∑ input(), —Å —Ç–∞–π–º–∞—É—Ç–æ–º
        run: |
          echo "üß™ –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø—É—Å–∫ .py —Ñ–∞–π–ª–æ–≤"
          find . -type f -name "*.py" | while read file; do
            if grep -q "input(" "$file"; then
              echo "‚è≠ –ü—Ä–æ–ø—É—â–µ–Ω $file (–æ–±–Ω–∞—Ä—É–∂–µ–Ω input())"
              continue
            fi
            echo "‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ $file"
            timeout 15s python "$file"
            if [ $? -eq 124 ]; then
              echo "‚ö†Ô∏è –¢–∞–π–º–∞—É—Ç: $file –≤—ã–ø–æ–ª–Ω—è–ª—Å—è —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ"
            fi
          done
