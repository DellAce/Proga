GAS LISTING task4.S 			page 1


   1              	/*
   2              	Asm: as -ahlsm=task4.lst --32 -gstabs+ -o task4.o task4.S
   3              	Ld:  ld -melf_i386 -o task4-exe-S task4.o
   4              	 */
   5              	
   6              	.include "my-macro"
   1              	/*
   2              	 * ÐœÐ°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹.
   3              	 * ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
   4              	 *     - ÐºÐ¾Ð´ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
   5              	 *
   6              	 * ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹: %e
   7              	 * Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ 'man 2 exit'
   8              	*/
   9              	.macro Exit ret_val
  10              	    movl $1, %eax         # Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚. Ð²Ñ‹Ð·Ð¾Ð²Ð° exit
  11              	    movl \ret_val, %ebx     # ÐºÐ¾Ð´ Ð²Ñ‹Ñ…Ð¾Ð´Ð°
  12              	    int $0x80         # Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  13              	.endm
  14              	
  15              	
  16              	/*
  17              	 * ÐœÐ°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð±Ð°Ð¹Ñ‚Ð° ÐºÐ¾Ð´Ð° Ñ
  18              	 * ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ð²Ð¾Ð´Ð°
  19              	 * ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
  20              	 *     - Ð°Ð´Ñ€ÐµÑ Ð±ÑƒÑ„ÐµÑ€Ð° Ð´Ð»Ñ ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð±Ð°Ð¹Ñ‚Ð°
  21              	 * Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:
  22              	 *    - Ð² %eax ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÑ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ñ… Ð±Ð°Ð¹Ñ‚Ð¾Ð²
  23              	 *    - Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ buf_addr - ÑÑ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ð¹ Ð±Ð°Ð¹Ñ‚
  24              	 *
  25              	 * ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹: %e
  26              	 * Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ 'man 2 read'
  27              	*/
  28              	.macro Getchar buf_addr
  29              	    movl $3, %eax        # Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚. Ð²Ñ‹Ð·Ð¾Ð²Ð° read
  30              	    movl $0, %ebx        # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 1: Ð´ÐµÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ñ€ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ð²Ð¾
  31              	    movl \buf_addr, %ecx    # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 2: Ð°Ð´Ñ€ÐµÑ Ð±ÑƒÑ„ÐµÑ€Ð° (Ð¾Ð½ Ð¶Ðµ - Ñ„Ð°ÐºÑ‚Ð¸Ñ‡
  32              	                     # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð°)
  33              	    movl $1, %edx        # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 3: ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð±Ð°Ð¹Ñ‚Ð¾Ð² Ð´Ð»Ñ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ
  34              	    int $0x80        # Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  35              	.endm
  36              	
  37              	/*
  38              	 * ÐœÐ°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ  Ð²Ñ‹Ð²Ð¾Ð´Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð» ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð
  39              	 * ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
  40              	 *     - Ð¡Ñ‚Ñ€Ð¾ÐºÐ° Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð°.
  41              	 *
  42              	 * ÐŸÑ€Ð¸Ð¼ÐµÑ‚Ñ€ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð°:
  43              	 *    Puts "Ð¢ÐµÐºÑÑ‚ Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼Ð¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸"
  44              	 *
  45              	 * Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:
  46              	 *    - Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ Ð² ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ‹ Ð·Ð°Ð´Ð°Ð½Ð½Ð¾Ð¹ ÑÑ‚Ñ€Ð
  47              	 *      Ð¸ Ð²ÑÐ»ÐµÐ´ Ð·Ð° Ð½Ð¸Ð¼Ð¸ ÑÐ¸Ð¼Ð²Ð¾Ð» Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸ \n
  48              	 *
  49              	 * ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹: %e
  50              	 * Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ 'man puts', 'man 2 write'
  51              	*/
GAS LISTING task4.S 			page 2


  52              	.macro Puts string
  53              	.data
  54              	    str\@:     .ascii "\string\n"  # Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ„Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð
  55              	
  56              	    strlen\@ =     . - str\@           # Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð´Ð»Ð¸Ð½Ñ‹ ÑÑ‚Ñ€Ð¾ÐºÐ
  57              	
  58              	.text
  59              	    movl $4, %eax        # Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚. Ð²Ñ‹Ð·Ð¾Ð²Ð° write
  60              	    movl $1, %ebx        # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 1: Ð´ÐµÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ñ€ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ñ‹Ð²
  61              	    movl $str\@, %ecx    # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 2: Ð°Ð´Ñ€ÐµÑ Ð¿Ð°Ð¼ÑÑ‚Ð¸ Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼Ñ‹Ð¼Ð¸ ÑÐ¸
  62              	    movl $strlen\@, %edx     # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 3: ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð±Ð°Ð¹Ñ‚Ð¾Ð² Ð´Ð»Ñ Ð²Ñ‹Ð²Ð
  63              	    int $0x80        # Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  64              	.endm
  65              	
  66              	.macro Finish
  67              	    movl $0, %ebx 	# first argument: exit code
  68              	    movl $1, %eax 	# sys_exit index
  69              	    int  $0x80 		# kernel interrupt
  70              	.endm
   7              	
   8              	.bss
   9              	    .lcomm summ, 2        # Ð½Ð°ÐºÐ¾Ð¿Ð»ÐµÐ½Ð½Ð°Ñ ÑÑƒÐ¼Ð¼Ð° 
  10              	    .lcomm c, 1           # Ð¾Ð´Ð½Ð¾Ð±Ð°Ð¹Ñ‚Ð¾Ð²Ñ‹Ð¹ Ð±ÑƒÑ„ÐµÑ€ Ð´Ð»Ñ Getchar
  11              	    .lcomm last, 1        # Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð²Ð²ÐµÐ´Ñ‘Ð½Ð½Ñ‹Ð¹ ÑÐ¸Ð¼Ð²Ð¾Ð»
  12              	    .lcomm buffer, 12     # Ð±ÑƒÑ„ÐµÑ€ Ð´Ð»Ñ Ð¿ÐµÑ‡Ð°Ñ‚Ð¸ Ñ‡Ð¸ÑÐ»Ð°
  13              	
  14              	.data
  15 0000 30000000 	    deff: .long 48         # ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ð° 0
  16              	
  17              	.text
  18              	.global _start
  19              	
  20              	_start:
  21 0000 29F6     	    sub %esi, %esi       # Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ° Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð° esi Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð²
  22              	
  23              	show_prompt:
  24              	    Puts "Ð’Ð²Ð¾Ð´Ð¸Ñ‚Ðµ Ñ†Ð¸Ñ„Ñ€Ñƒ, Ð´Ñ€ÑƒÐ³ Ð¼Ð¾Ð¹!"     # Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð² Ð²Ñ‹Ð²Ð¾Ð´Ð° ÑÑ‚
  24              	> .data 
  24 0004 D092D0B2 	>  str0:.ascii "Ð’Ð²Ð¾Ð´Ð¸Ñ‚Ðµ Ñ†Ð¸Ñ„Ñ€Ñƒ, Ð´Ñ€ÑƒÐ³ Ð¼Ð¾Ð¹!\n"
  24      D0BED0B4 
  24      D0B8D182 
  24      D0B520D1 
  24      86D0B8D1 
  24              	>  
  24              	>  strlen0 =. - str0
  24              	>  
  24              	> .text 
  24 0002 B8040000 	>  movl $4,%eax
  24      00
  24 0007 BB010000 	>  movl $1,%ebx
  24      00
  24 000c B9040000 	>  movl $str0,%ecx
  24      00
  24 0011 BA2C0000 	>  movl $strlen0,%edx
  24      00
  24 0016 CD80     	>  int $0x80
  25              	
GAS LISTING task4.S 			page 3


  26              	kbd_input:
  27              	    Getchar $c             # Ð²Ð²Ð¾Ð´ Ð±Ð°Ð¹Ñ‚Ð° c
  27 0018 B8030000 	>  movl $3,%eax
  27      00
  27 001d BB000000 	>  movl $0,%ebx
  27      00
  27 0022 B9020000 	>  movl $c,%ecx
  27      00
  27              	>  
  27 0027 BA010000 	>  movl $1,%edx
  27      00
  27 002c CD80     	>  int $0x80
  28 002e 83F800   	    cmpl $0, %eax          # Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð° EOF
  29 0031 0F849100 	    je output_sum          # ÐµÑÐ»Ð¸ EOF, Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ð¼ Ðº Ð²Ñ‹Ð²Ð¾Ð´Ñƒ ÑÑƒÐ¼Ð¼Ñ‹
  29      0000
  30              	
  31 0037 803D0200 	    cmpb $'\n', c          # Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð° Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´ ÑÑ‚Ñ€Ð¾ÐºÐ¸
  31      00000A
  32 003e 7434     	    je last_in_eax          # ÐµÑÐ»Ð¸ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´ ÑÑ‚Ñ€Ð¾ÐºÐ¸, Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ð¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸
  33 0040 803D0200 	    cmpb $'9', c           # Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð° ÑÐ¸Ð¼Ð²Ð¾Ð» Ð±Ð¾Ð»ÑŒÑˆÐµ '9'
  33      000039
  34 0047 7764     	    ja print_err_msg        # ÐµÑÐ»Ð¸ Ð±Ð¾Ð»ÑŒÑˆÐµ '9', Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¾Ñ
  35 0049 803D0200 	    cmpb $'0', c           # Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð° ÑÐ¸Ð¼Ð²Ð¾Ð» Ð¼ÐµÐ½ÑŒÑˆÐµ '0'
  35      000030
  36 0050 725B     	    jb print_err_msg        # ÐµÑÐ»Ð¸ Ð¼ÐµÐ½ÑŒÑˆÐµ '0', Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¾Ñ
  37              	
  38 0052 A0020000 	    movb c, %al            # Ð¿ÐµÑ€ÐµÐ½Ð¾Ñ ÐºÐ¾Ð´Ð° ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° Ð² AL
  38      00
  39 0057 A2030000 	    movb %al, last         # ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ Ð²Ð²ÐµÐ´ÐµÐ½Ð½Ð¾Ð³Ð¾ ÑÐ¸Ð¼Ð
  39      00
  40              	
  41              	    Puts "Ð¦Ð¸Ñ„Ñ€Ð°! Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾."   # ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ð¼ Ð²Ð²Ð¾Ð´Ðµ Ñ†Ð¸Ñ„
  41              	> .data 
  41 0030 D0A6D0B8 	>  str2:.ascii "Ð¦Ð¸Ñ„Ñ€Ð°! Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾.\n"
  41      D184D180 
  41      D0B02120 
  41      D0A5D0BE 
  41      D180D0BE 
  41              	>  
  41              	>  strlen2 =. - str2
  41              	>  
  41              	> .text 
  41 005c B8040000 	>  movl $4,%eax
  41      00
  41 0061 BB010000 	>  movl $1,%ebx
  41      00
  41 0066 B9300000 	>  movl $str2,%ecx
  41      00
  41 006b BA1A0000 	>  movl $strlen2,%edx
  41      00
  41 0070 CD80     	>  int $0x80
  42 0072 EB8E     	    jmp show_prompt        # Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ðº Ð²Ð²Ð¾Ð´Ñƒ
  43              	
  44              	last_in_eax:
  45 0074 31C0     	    xor %eax, %eax          # Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ° Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð° eax
  46 0076 A0030000 	    movb last, %al          # Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ð° ÐºÐ¾Ð´Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° Ð² AL
  46      00
GAS LISTING task4.S 			page 4


  47 007b 2C30     	    subb $48, %al           # Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° Ð² Ñ†Ð¸Ñ„Ñ€Ñƒ
  48              	
  49 007d 6631C9   	    xor %cx, %cx            # Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ° Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð° cx
  50 0080 88C1     	    movb %al, %cl           # Ð¿ÐµÑ€ÐµÐ½Ð¾Ñ Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð² CL
  51 0082 66A10000 	    movw summ, %ax          # Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ ÑÑƒÐ¼Ð¼Ñ‹
  51      0000
  52 0088 6601C8   	    addw %cx, %ax           # Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ†Ð¸Ñ„Ñ€Ñ‹ Ðº ÑÑƒÐ¼Ð¼Ðµ
  53 008b 7208     	    jc print_overflow_msg   # ÐµÑÐ»Ð¸ Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ, Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
  54 008d 66A30000 	    movw %ax, summ          # Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑƒÐ¼Ð¼Ñ‹
  54      0000
  55 0093 EB83     	    jmp kbd_input           # Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ðº Ð²Ð²Ð¾Ð´Ñƒ
  56              	
  57              	print_overflow_msg:
  58              	    Puts "Ð‘ÑƒÑ„Ñ„ÐµÑ€ Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð»Ð½ÐµÐ½"  # ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ð¸
  58              	> .data 
  58 004a D091D183 	>  str3:.ascii "Ð‘ÑƒÑ„Ñ„ÐµÑ€ Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð»Ð½ÐµÐ½\n"
  58      D184D184 
  58      D0B5D180 
  58      20D0BFD0 
  58      B5D180D0 
  58              	>  
  58              	>  strlen3 =. - str3
  58              	>  
  58              	> .text 
  58 0095 B8040000 	>  movl $4,%eax
  58      00
  58 009a BB010000 	>  movl $1,%ebx
  58      00
  58 009f B94A0000 	>  movl $str3,%ecx
  58      00
  58 00a4 BA220000 	>  movl $strlen3,%edx
  58      00
  58 00a9 CD80     	>  int $0x80
  59 00ab EB7C     	    jmp stop
  60              	
  61              	print_err_msg:
  62              	    Puts "ÐÐµ Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ð°Ñ ÐºÐ»Ð°Ð²Ð¸ÑˆÐ°. ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ Ð²Ð²Ð¾Ð´"  # ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ 
  62              	> .data 
  62 006c D09DD0B5 	>  str4:.ascii "ÐÐµ Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ð°Ñ ÐºÐ»Ð°Ð²Ð¸ÑˆÐ°. ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ Ð²Ð²Ð¾Ð´\n"
  62      20D186D0 
  62      B8D184D1 
  62      80D0BED0 
  62      B2D0B0D1 
  62              	>  
  62              	>  strlen4 =. - str4
  62              	>  
  62              	> .text 
  62 00ad B8040000 	>  movl $4,%eax
  62      00
  62 00b2 BB010000 	>  movl $1,%ebx
  62      00
  62 00b7 B96C0000 	>  movl $str4,%ecx
  62      00
  62 00bc BA420000 	>  movl $strlen4,%edx
  62      00
  62 00c1 CD80     	>  int $0x80
  63 00c3 E93AFFFF 	    jmp show_prompt
GAS LISTING task4.S 			page 5


  63      FF
  64              	
  65              	output_sum:
  66 00c8 31C0     	    xor %eax, %eax          # Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ° Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð° eax
  67 00ca 66A10000 	    movw summ, %ax          # Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÑƒÐ¼Ð¼Ñ‹ Ð² AX
  67      0000
  68 00d0 31DB     	    xor %ebx, %ebx          # ÑÐ±Ñ€Ð¾Ñ ÑÑ‡ÐµÑ‚Ñ‡Ð¸ÐºÐ° ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²
  69              	
  70              	print_digit:
  71 00d2 31D2     	    xor %edx, %edx          # ÑÐ±Ñ€Ð¾Ñ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð° edx
  72 00d4 66B90A00 	    movw $10, %cx           # Ð´ÐµÐ»Ð¸Ñ‚ÐµÐ»ÑŒ 10
  73 00d8 66F7F1   	    div %cx                 # Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ AX Ð½Ð° 10, Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº Ð² DX
  74 00db 80C230   	    add $48, %dl            # Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ° Ð² ÐºÐ¾Ð´
  75 00de 88930800 	    movb %dl, buffer(%ebx)  # Ð·Ð°Ð¿Ð¸ÑÑŒ Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð² Ð±ÑƒÑ„ÐµÑ€
  75      0000
  76 00e4 43       	    incl %ebx               # ÑƒÐ²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð¸Ðµ ÑÑ‡ÐµÑ‚Ñ‡Ð¸ÐºÐ°
  77 00e5 6685C0   	    test %ax, %ax           # Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð° Ð½Ð¾Ð»ÑŒ
  78 00e8 75E8     	    jnz print_digit         # ÐµÑÐ»Ð¸ Ð½Ðµ Ð½Ð¾Ð»ÑŒ, Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÐ¼ Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ
  79              	
  80              	print_number:
  81 00ea 4B       	    decl %ebx               # Ð´ÐµÐºÑ€ÐµÐ¼ÐµÐ½Ñ‚ ÑÑ‡ÐµÑ‚Ñ‡Ð¸ÐºÐ° ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²
  82 00eb 83FB00   	    cmp $0, %ebx            # Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð° ÐºÐ¾Ð½ÐµÑ† Ð²Ñ‹Ð²Ð¾Ð´Ð°
  83 00ee 7C1B     	    jl finish_output
  84              	
  85 00f0 8D8B0800 	    lea buffer(%ebx), %ecx  # Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð°Ð´Ñ€ÐµÑÐ° Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ Ñ†Ð¸Ñ„Ñ€Ñ‹
  85      0000
  86 00f6 53       	    push %ebx               # ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ ÑÑ‡ÐµÑ‚Ñ‡Ð¸ÐºÐ°
  87 00f7 B8040000 	    movl $4, %eax           # sys_write
  87      00
  88 00fc BB010000 	    movl $1, %ebx           # Ð´ÐµÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ñ€ stdout
  88      00
  89 0101 BA010000 	    movl $1, %edx           # Ð´Ð»Ð¸Ð½Ð° Ð²Ñ‹Ð²Ð¾Ð´Ð° 1
  89      00
  90 0106 CD80     	    int $0x80               # ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  91              	
  92 0108 5B       	    pop %ebx                # Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑ‡ÐµÑ‚Ñ‡Ð¸ÐºÐ°
  93 0109 EBDF     	    jmp print_number        # Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¹ Ñ†Ð¸Ñ„Ñ€Ñ‹
  94              	
  95              	finish_output:
  96 010b C6050800 	    movb $'\n', buffer     # Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð² Ð±ÑƒÑ„ÐµÑ€
  96      00000A
  97 0112 B8040000 	    movl $4, %eax
  97      00
  98 0117 BB010000 	    movl $1, %ebx
  98      00
  99 011c 8D0D0800 	    lea buffer, %ecx
  99      0000
 100 0122 BA010000 	    movl $1, %edx
 100      00
 101 0127 CD80     	    int $0x80
 102              	
 103              	stop:
 104              	    Exit $0
 104 0129 B8010000 	>  movl $1,%eax
 104      00
 104 012e BB000000 	>  movl $0,%ebx
 104      00
GAS LISTING task4.S 			page 6


 104 0133 CD80     	>  int $0x80
 105              	
 106              	.end
GAS LISTING task4.S 			page 7


DEFINED SYMBOLS
             task4.S:9      .bss:00000000 summ
             task4.S:9      .bss:00000002 c
             task4.S:10     .bss:00000003 last
             task4.S:12     .bss:00000008 buffer
             task4.S:15     .data:00000000 deff
             task4.S:20     .text:00000000 _start
             task4.S:23     .text:00000002 show_prompt
             task4.S:24     .data:00000004 str0
             task4.S:24     *ABS*:0000002c strlen0
             task4.S:26     .text:00000018 kbd_input
             task4.S:65     .text:000000c8 output_sum
             task4.S:44     .text:00000074 last_in_eax
             task4.S:61     .text:000000ad print_err_msg
             task4.S:41     .data:00000030 str2
             task4.S:41     *ABS*:0000001a strlen2
             task4.S:57     .text:00000095 print_overflow_msg
             task4.S:58     .data:0000004a str3
             task4.S:58     *ABS*:00000022 strlen3
             task4.S:103    .text:00000129 stop
             task4.S:62     .data:0000006c str4
             task4.S:62     *ABS*:00000042 strlen4
             task4.S:70     .text:000000d2 print_digit
             task4.S:80     .text:000000ea print_number
             task4.S:95     .text:0000010b finish_output

NO UNDEFINED SYMBOLS
