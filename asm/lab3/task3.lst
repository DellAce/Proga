GAS LISTING task3.S 			page 1


   1              	/*
   2              	 * ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð° Ð²Ð²Ð¾Ð´Ð° ÐºÐ¾Ð´Ð¾Ð² Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ñ‹Ñ… ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð² Ð² Ð±ÑƒÑ„ÐµÑ€ Ð² ÐžÐŸ
   3              	 */
   4              	
   5              	.include "my-macro"
   1              	/*
   2              	 * ÐœÐ°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹.
   3              	 * ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
   4              	 *     - ÐºÐ¾Ð´ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
   5              	 *
   6              	 * ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹: %e
   7              	 * Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ 'man 2 exit'
   8              	*/
   9              	.macro Exit ret_val
  10              	    movl $1, %eax         # Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚. Ð²Ñ‹Ð·Ð¾Ð²Ð° exit
  11              	    movl \ret_val, %ebx     # ÐºÐ¾Ð´ Ð²Ñ‹Ñ…Ð¾Ð´Ð°
  12              	    int $0x80         # Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  13              	.endm
  14              	
  15              	
  16              	/*
  17              	 * ÐœÐ°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð±Ð°Ð¹Ñ‚Ð° ÐºÐ¾Ð´Ð° Ñ
  18              	 * ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ð²Ð¾Ð´Ð°
  19              	 * ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
  20              	 *     - Ð°Ð´Ñ€ÐµÑ Ð±ÑƒÑ„ÐµÑ€Ð° Ð´Ð»Ñ ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð±Ð°Ð¹Ñ‚Ð°
  21              	 * Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:
  22              	 *    - Ð² %eax ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÑ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ñ… Ð±Ð°Ð¹Ñ‚Ð¾Ð²
  23              	 *    - Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ buf_addr - ÑÑ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ð¹ Ð±Ð°Ð¹Ñ‚
  24              	 *
  25              	 * ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹: %e
  26              	 * Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ 'man 2 read'
  27              	*/
  28              	.macro Getchar buf_addr
  29              	    movl $3, %eax        # Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚. Ð²Ñ‹Ð·Ð¾Ð²Ð° read
  30              	    movl $0, %ebx        # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 1: Ð´ÐµÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ñ€ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ð²Ð¾
  31              	    movl \buf_addr, %ecx    # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 2: Ð°Ð´Ñ€ÐµÑ Ð±ÑƒÑ„ÐµÑ€Ð° (Ð¾Ð½ Ð¶Ðµ - Ñ„Ð°ÐºÑ‚Ð¸Ñ‡
  32              	                     # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð°)
  33              	    movl $1, %edx        # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 3: ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð±Ð°Ð¹Ñ‚Ð¾Ð² Ð´Ð»Ñ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ
  34              	    int $0x80        # Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  35              	.endm
  36              	
  37              	/*
  38              	 * ÐœÐ°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ  Ð²Ñ‹Ð²Ð¾Ð´Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð» ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð
  39              	 * ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
  40              	 *     - Ð¡Ñ‚Ñ€Ð¾ÐºÐ° Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð°.
  41              	 *
  42              	 * ÐŸÑ€Ð¸Ð¼ÐµÑ‚Ñ€ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð°:
  43              	 *    Puts "Ð¢ÐµÐºÑÑ‚ Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼Ð¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸"
  44              	 *
  45              	 * Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:
  46              	 *    - Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ Ð² ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ‹ Ð·Ð°Ð´Ð°Ð½Ð½Ð¾Ð¹ ÑÑ‚Ñ€Ð
  47              	 *      Ð¸ Ð²ÑÐ»ÐµÐ´ Ð·Ð° Ð½Ð¸Ð¼Ð¸ ÑÐ¸Ð¼Ð²Ð¾Ð» Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸ \n
  48              	 *
  49              	 * ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹: %e
  50              	 * Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ 'man puts', 'man 2 write'
  51              	*/
  52              	.macro Puts string
GAS LISTING task3.S 			page 2


  53              	.data
  54              	    str\@:     .ascii "\string\n"  # Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ„Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð
  55              	
  56              	    strlen\@ =     . - str\@           # Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð´Ð»Ð¸Ð½Ñ‹ ÑÑ‚Ñ€Ð¾ÐºÐ
  57              	
  58              	.text
  59              	    movl $4, %eax        # Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚. Ð²Ñ‹Ð·Ð¾Ð²Ð° write
  60              	    movl $1, %ebx        # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 1: Ð´ÐµÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ñ€ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ñ‹Ð²
  61              	    movl $str\@, %ecx    # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 2: Ð°Ð´Ñ€ÐµÑ Ð¿Ð°Ð¼ÑÑ‚Ð¸ Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼Ñ‹Ð¼Ð¸ ÑÐ¸
  62              	    movl $strlen\@, %edx     # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 3: ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð±Ð°Ð¹Ñ‚Ð¾Ð² Ð´Ð»Ñ Ð²Ñ‹Ð²Ð
  63              	    int $0x80        # Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  64              	.endm
   6              	
   7              	.bss
   8              	    .lcomm buf, 100 # 100 Ð±Ð°Ð¹Ñ‚Ð¾Ð²Ñ‹Ð¹ Ð±ÑƒÑ„ÐµÑ€ Ð´Ð»Ñ ÐºÐ¾Ð´Ð¾Ð² Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ñ… ÑÐ¸
   9              	    .lcomm c, 1    # Ð¾Ð´Ð½Ð¾Ð±Ð°Ð¹Ñ‚Ð¾Ð²Ñ‹Ð¹ Ð±ÑƒÑ„ÐµÑ€ Ð´Ð»Ñ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ Ð±Ð°Ð¹Ñ‚Ð° Ð¸Ð· Ñ„Ð°Ð¹
  10              	    .lcomm last, 1 # Ð¾Ð´Ð½Ð¾Ð±Ð°Ð¹Ñ‚Ð¾Ð²Ñ‹Ð¹ Ð±ÑƒÑ„ÐµÑ€ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³
  11              	
  12              	.data
  13 0000 30000000 	deff: .long 48
  14              	.text
  15              	.global _start
  16              	
  17              	_start:
  18 0000 29F6     	    sub    %esi, %esi     # ÑƒÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒ Ð°Ð´Ñ€ÐµÑÐ° Ð±Ð°Ð¹Ñ‚Ð° Ð² Ð±ÑƒÑ„ÐµÑ€Ðµ buf (Ð¸Ð½Ð´Ð
  19              	
  20              	show_prompt:
  21              	    Puts "Ð’Ð²Ð¾Ð´Ð¸Ñ‚Ðµ Ñ†Ð¸Ñ„Ñ€Ñƒ, Ð´Ñ€ÑƒÐ³ Ð¼Ð¾Ð¹!"     # Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð² Ð²Ñ‹Ð²Ð¾Ð´Ð° ÑÑ‚
  21              	> .data 
  21 0004 D092D0B2 	>  str0:.ascii "Ð’Ð²Ð¾Ð´Ð¸Ñ‚Ðµ Ñ†Ð¸Ñ„Ñ€Ñƒ, Ð´Ñ€ÑƒÐ³ Ð¼Ð¾Ð¹!\n"
  21      D0BED0B4 
  21      D0B8D182 
  21      D0B520D1 
  21      86D0B8D1 
  21              	>  
  21              	>  strlen0 =. - str0
  21              	>  
  21              	> .text 
  21 0002 B8040000 	>  movl $4,%eax
  21      00
  21 0007 BB010000 	>  movl $1,%ebx
  21      00
  21 000c B9040000 	>  movl $str0,%ecx
  21      00
  21 0011 BA2C0000 	>  movl $strlen0,%edx
  21      00
  21 0016 CD80     	>  int $0x80
  22              	                    # Ñ„Ð°Ð¹Ð» stdout (Ð¿Ð¾Ð´ÑÐºÐ°Ð·ÐºÐ° Ð²Ð²Ð¾Ð´Ð°)
  23              	
  24              	kbd_input:
  25              	    Getchar $c          # Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð² Ð²Ð²Ð¾Ð´Ð° Ð±Ð°Ð¹Ñ‚Ð° Ð¸Ð· stdin Ð²
  25 0018 B8030000 	>  movl $3,%eax
  25      00
  25 001d BB000000 	>  movl $0,%ebx
  25      00
  25 0022 B9640000 	>  movl $c,%ecx
  25      00
GAS LISTING task3.S 			page 3


  25              	>  
  25 0027 BA010000 	>  movl $1,%edx
  25      00
  25 002c CD80     	>  int $0x80
  26              	            # Ð¿Ñ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½Ñ‹Ð¹ Ð±ÑƒÑ„ÐµÑ€ c
  27 002e 83F800   	    cmpl $0, %eax     # Ð½Ð°ÑÑ‚ÑƒÐ¿Ð¸Ð»Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ EOF (ÐºÐ¾Ð½ÐµÑ† Ñ„Ð°Ð¹Ð»Ð° stdin) ? 
  28 0031 0F84A800 	    je stop        # Ð”Ð° - Ð½Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
  28      0000
  29              	    Puts "Ð¡Ð¸Ð¼Ð²Ð¾Ð» ÑƒÑÐ¿ÐµÑÐ½Ð¾ ÑÑ‡Ð¸Ñ‚Ð°Ð½ ÐºÐ° Ð²Ð°Ð¿ Ð²Ð° Ñ€Ð²Ð° Ð¿Ñ€Ð¿ Ð°Ð¿Ñ€ Ð¿ Ñ€ Ð¿ Ð
  29              	> .data 
  29 0030 D0A1D0B8 	>  str2:.ascii "Ð¡Ð¸Ð¼Ð²Ð¾Ð» ÑƒÑÐ¿ÐµÑÐ½Ð¾ ÑÑ‡Ð¸Ñ‚Ð°Ð½ ÐºÐ° Ð²Ð°Ð¿ Ð²Ð° Ñ€Ð²Ð° Ð¿Ñ€Ð¿ Ð°Ð¿Ñ€ Ð¿ Ñ€ Ð¿ Ð¿ Ð° Ñ€Ð°Ð¿ Ñ€  Ñ€Ð° Ð¿Ñ€ Ð¿Ð°Ñ€ Ð°Ð¿ Ñ€ Ð¿Ð° Ñ€Ð¿ Ð°Ð² Ñ€ Ð¿Ð° Ð²Ñ€ Ð¿Ð° Ñ€Ð¿ Ð°Ñ€ Ð°Ð¿Ð² Ñ€ Ð¿Ð° Ñ€ Ð¿Ð°Ñ€ Ð°Ð¿ Ñ€ Ð¿ Ñ€Ð²Ð¿Ð° Ñ€ Ð¿Ð°Ñ€ Ð¿Ð° Ñ€ Ð¿ Ñ€ Ð°Ð¿Ð²Ñ€ Ð¿Ð° Ñ€ Ð¿Ð° Ñ€Ð¿ Ñ€ Ñ‹Ð² Ð²Ñ€ Ñ‹Ð¿ Ð² ÐºÐµ  Ð½  ÐºÐ½  Ð²Ð¿Ñ€ Ð²Ð°Ð¿ Ð² Ñ€ Ð¿Ñ€ Ñ€   Ð¿  Ð²Ñ€Ð² Ñ€ Ð¿  Ð°Ð¿ Ð°Ñ€ Ð¿Ð¿ Ð²Ð¿Ñ€ Ð² Ð²Ð¿ Ñ€ Ð¿Ñ€ Ð²Ð°Ð¿Ñ€  Ð²Ñ€  Ð¿Ð²   Ð¿ Ñ€Ð°Ñ€ Ð² Ð°Ñ€ Ñ€  Ð¿Ñ€\n"
  29      D0BCD0B2 
  29      D0BED0BB 
  29      20D183D1 
  29      81D0BFD0 
  29              	>  
  29              	>  strlen2 =. - str2
  29              	>  
  29              	> .text 
  29 0037 B8040000 	>  movl $4,%eax
  29      00
  29 003c BB010000 	>  movl $1,%ebx
  29      00
  29 0041 B9300000 	>  movl $str2,%ecx
  29      00
  29 0046 BABA0100 	>  movl $strlen2,%edx
  29      00
  29 004b CD80     	>  int $0x80
  30 004d 803D6400 	    cmpb $'\n', c     # ÑÑ‚Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð» Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸ ?
  30      00000A
  31 0054 7448     	    je last_in_eax     # Ð”Ð - Ð½Ð° Ð²Ð²Ð¾Ð´ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°
  32 0056 803D6400 	    cmpb $'9', c      # ÐºÐ¾Ð´ Ð±Ð¾Ð»ÑŒÑˆÐµ ÐºÐ¾Ð´Ð° ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° '9' ?
  32      000039
  33 005d 7765     	    ja print_err_msg    # Ð”Ð - Ð½Ð° Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ
  34 005f 803D6400 	    cmpb $'0', c    # ÐºÐ¾Ð´ Ð¼ÐµÐ½ÑŒÑˆÐµ ÐºÐ¾Ð´Ð° ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° '0' ?
  34      000030
  35 0066 725C     	    jb print_err_msg    # Ð”Ð - Ð½Ð° Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ
  36 0068 A0640000 	    movb c, %al         # Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‚ÑŒ ÐºÐ¾Ð´ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° Ð¸Ð· c Ð² al
  36      00
  37 006d A2650000 	    movb %al, last      # ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ ÑÐ¸Ð¼Ð²Ð¾Ð»
  37      00
  38              	
  39 0072 A0640000 	    movb c, %al         # Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‚ÑŒ ÐºÐ¾Ð´ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð¸Ð· c Ð² al
  39      00
  40 0077 88860000 	    movb %al, buf(%esi) # Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‚ÑŒ ÐºÐ¾Ð´ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð¸Ð· al Ð² Ð±Ð°Ð¹Ñ‚
  40      0000
  41              	            # Ð±ÑƒÑ„ÐµÑ€Ð° Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ &buf + esi
  42 007d 46       	    incl %esi        # ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð½Ð° ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ Ð±Ð°Ð¹Ñ‚ Ð±ÑƒÑ„ÐµÑ€Ð° Ð´Ð»Ñ
  43              	            # ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÐºÐ¾Ð´Ð°
  44 007e 83FE64   	    cmpl $100, %esi     # Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°: Ð´Ð¾ÑÑ‚Ð¸Ð³Ð½ÑƒÑ‚ Ð»Ð¸ Ð¿Ñ€ÐµÐ´ÐµÐ» Ð±ÑƒÑ„ÐµÑ€Ð°?
  45 0081 7429     	    je buffer_overflow      # ÐµÑÐ»Ð¸ Ð´Ð°, Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ðº Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸ÑŽ Ñ ÑÐ¾Ð¾Ð±Ñ‰Ðµ
  46              	
  47              	    Puts "Ð¦Ð¸Ñ„Ñ€Ð°! Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾." # ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± ÑƒÑÐ¿ÐµÑ…Ðµ Ð²Ð²Ð¾Ð´Ðµ
  47              	> .data 
  47 01ea D0A6D0B8 	>  str3:.ascii "Ð¦Ð¸Ñ„Ñ€Ð°! Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾.\n"
  47      D184D180 
  47      D0B02120 
GAS LISTING task3.S 			page 4


  47      D0A5D0BE 
  47      D180D0BE 
  47              	>  
  47              	>  strlen3 =. - str3
  47              	>  
  47              	> .text 
  47 0083 B8040000 	>  movl $4,%eax
  47      00
  47 0088 BB010000 	>  movl $1,%ebx
  47      00
  47 008d B9EA0100 	>  movl $str3,%ecx
  47      00
  47 0092 BA1A0000 	>  movl $strlen3,%edx
  47      00
  47 0097 CD80     	>  int $0x80
  48              	
  49 0099 E964FFFF 	    jmp show_prompt    # Ð½Ð° Ð²Ð²Ð¾Ð´ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°
  49      FF
  50              	last_in_eax:
  51 009e 31C0     	    xor %eax, %eax     #Ð¾Ñ‡Ð¸Ñ‰Ð°ÐµÐ¼ eax
  52 00a0 A0650000 	    movb last, %al     # Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‚ÑŒ ÐºÐ¾Ð´ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° Ð² al
  52      00
  53 00a5 2C30     	    subb $48, %al       # Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ñ‚ÑŒ Ð² Ñ†Ð¸Ñ„Ñ€Ñƒ
  54 00a7 E96CFFFF 	    jmp kbd_input
  54      FF
  55              	
  56              	buffer_overflow:
  57              	    Puts "Ð‘ÑƒÑ„ÐµÑ€ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½."
  57              	> .data 
  57 0204 D091D183 	>  str4:.ascii "Ð‘ÑƒÑ„ÐµÑ€ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½.\n"
  57      D184D0B5 
  57      D18020D0 
  57      B7D0B0D0 
  57      BFD0BED0 
  57              	>  
  57              	>  strlen4 =. - str4
  57              	>  
  57              	> .text 
  57 00ac B8040000 	>  movl $4,%eax
  57      00
  57 00b1 BB010000 	>  movl $1,%ebx
  57      00
  57 00b6 B9040200 	>  movl $str4,%ecx
  57      00
  57 00bb BA1D0000 	>  movl $strlen4,%edx
  57      00
  57 00c0 CD80     	>  int $0x80
  58 00c2 EB1B     	    jmp stop     # Ð½Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
  59              	
  60              	print_err_msg:
  61              	    Puts "ÐÐµ Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ð°Ñ ÐºÐ»Ð°Ð²Ð¸ÑˆÐ°. ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ Ð²Ð²Ð¾Ð´"    # Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¾Ð¾
  61              	> .data 
  61 0221 D09DD0B5 	>  str5:.ascii "ÐÐµ Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ð°Ñ ÐºÐ»Ð°Ð²Ð¸ÑˆÐ°. ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ Ð²Ð²Ð¾Ð´\n"
  61      20D186D0 
  61      B8D184D1 
  61      80D0BED0 
  61      B2D0B0D1 
GAS LISTING task3.S 			page 5


  61              	>  
  61              	>  strlen5 =. - str5
  61              	>  
  61              	> .text 
  61 00c4 B8040000 	>  movl $4,%eax
  61      00
  61 00c9 BB010000 	>  movl $1,%ebx
  61      00
  61 00ce B9210200 	>  movl $str5,%ecx
  61      00
  61 00d3 BA420000 	>  movl $strlen5,%edx
  61      00
  61 00d8 CD80     	>  int $0x80
  62 00da E923FFFF 	    jmp show_prompt     # Ð½Ð° Ð²Ð²Ð¾Ð´ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°
  62      FF
  63              	
  64              	stop:
  65              	    Exit $0
  65 00df B8010000 	>  movl $1,%eax
  65      00
  65 00e4 BB000000 	>  movl $0,%ebx
  65      00
  65 00e9 CD80     	>  int $0x80
  66              	
  67              	.end
GAS LISTING task3.S 			page 6


DEFINED SYMBOLS
             task3.S:8      .bss:00000000 buf
             task3.S:8      .bss:00000064 c
             task3.S:9      .bss:00000065 last
             task3.S:13     .data:00000000 deff
             task3.S:17     .text:00000000 _start
             task3.S:20     .text:00000002 show_prompt
             task3.S:21     .data:00000004 str0
             task3.S:21     *ABS*:0000002c strlen0
             task3.S:24     .text:00000018 kbd_input
             task3.S:64     .text:000000df stop
             task3.S:29     .data:00000030 str2
             task3.S:29     *ABS*:000001ba strlen2
             task3.S:50     .text:0000009e last_in_eax
             task3.S:60     .text:000000c4 print_err_msg
             task3.S:56     .text:000000ac buffer_overflow
             task3.S:47     .data:000001ea str3
             task3.S:47     *ABS*:0000001a strlen3
             task3.S:57     .data:00000204 str4
             task3.S:57     *ABS*:0000001d strlen4
             task3.S:61     .data:00000221 str5
             task3.S:61     *ABS*:00000042 strlen5

NO UNDEFINED SYMBOLS
